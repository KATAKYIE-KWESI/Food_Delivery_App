{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JollyFoods Checkout</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'payment.css' %}">
</head>
<body>

<div class="checkout-container">
    <div class="checkout-card">
        <div class="badge">
            <i class="fa-solid fa-shield-halved"></i> SECURE
        </div>

        <div class="logo">JollyFoods<span>.</span></div>
        <p class="tagline">Delicious moments, delivered with love</p>

        <!-- Order Items Preview -->
        <div class="order-items">
            <h3>
                <i class="fa-solid fa-receipt"></i>
                Your Order
            </h3>
            <div class="item">
                <span class="item-name">
                    <i class="fa-solid fa-circle"></i>
                    Jollof Rice Special
                </span>
                <span class="item-price">GHS 15.00</span>
            </div>
            <div class="item">
                <span class="item-name">
                    <i class="fa-solid fa-circle"></i>
                    Grilled Chicken
                </span>
                <span class="item-price">GHS 12.50</span>
            </div>
            <div class="item">
                <span class="item-name">
                    <i class="fa-solid fa-circle"></i>
                    Fresh Juice
                </span>
                <span class="item-price">GHS 5.00</span>
            </div>
        </div>

        <!-- Order Summary -->
        <div class="order-summary">
            <div class="summary-row">
                <span>Subtotal</span>
                <span>GHS 32.50</span>
            </div>
            <div class="summary-row">
                <span>Delivery Fee</span>
                <span>GHS 3.00</span>
            </div>
            <div class="summary-row">
                <span>Service Fee</span>
                <span>GHS 2.77</span>
            </div>

            <div class="summary-divider"></div>

            <div class="total-row">
                <p>Total Amount</p>
                <h1>GHS {{ total_ghs|floatformat:2 }}</h1>
            </div>
        </div>

        <!-- Payment Methods -->
        <div class="payment-methods">
            <div class="payment-method active">
                <i class="fa-solid fa-credit-card"></i>
                <p>Card</p>
            </div>
            <div class="payment-method">
                <i class="fa-solid fa-mobile-screen-button"></i>
                <p>Mobile Money</p>
            </div>
            <div class="payment-method">
                <i class="fa-solid fa-building-columns"></i>
                <p>Bank</p>
            </div>
        </div>

        <!-- Pay Button -->
        <button type="button" class="pay-btn" onclick="payWithPaystack()">
            <i class="fa-solid fa-lock"></i> Pay Securely Now
        </button>

        <div class="loading">
            <div class="loading-dot"></div>
            <div class="loading-dot"></div>
            <div class="loading-dot"></div>
        </div>

        <!-- Security Badges -->
        <div class="security-badges">
            <div class="security-badge">
                <i class="fa-solid fa-shield-halved"></i>
                <span>SSL Encrypted</span>
            </div>
            <div class="security-badge">
                <i class="fa-solid fa-check-circle"></i>
                <span>PCI Compliant</span>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer-icons">
            <i class="fa-solid fa-lock"></i>
            Secured by <strong>Paystack</strong>
        </div>

        <!-- Trust Indicators -->
        <div class="trust-indicators">
            <div class="trust-indicator">
                <i class="fa-solid fa-clock"></i>
                <span>Fast Delivery</span>
            </div>
            <div class="trust-indicator">
                <i class="fa-solid fa-rotate-left"></i>
                <span>Easy Returns</span>
            </div>
            <div class="trust-indicator">
                <i class="fa-solid fa-headset"></i>
                <span>24/7 Support</span>
            </div>
        </div>
    </div>
</div>

<script src="https://js.paystack.co/v1/inline.js"></script>
<script>
    // Payment method selection
    document.querySelectorAll('.payment-method').forEach(method => {
        method.addEventListener('click', function() {
            document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('active'));
            this.classList.add('active');
        });
    });

    // Paystack payment
    function payWithPaystack() {
        let handler = PaystackPop.setup({
            key: '{{ paystack_public_key }}',
            amount: {{ paystack_amount }},
            email: '{{ request.user.email|default:"customer@jollyfoods.com" }}',
            currency: 'GHS',
            ref: 'JF_' + Math.floor((Math.random() * 1000000000) + 1),
            callback: function(response) {
                alert('Success! Reference: ' + response.reference);
                window.location.href = "{% url 'homepage' %}";
            },
            onClose: function() {
                alert('Window closed.');
            }
        });
        handler.openIframe();
    }
</script>

</body>
</html>
