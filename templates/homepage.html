{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JollyFoods</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'homepage.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'auth_modal.css' %}">

</head>
<body>

<!---------------------------------Nav Bar  ------------------------------------------->
   <div class="navbar">

       <a href="{% url 'homepage' %}" class="logo">  <i class="fa-solid fa-utensils"></i>  JollyFoods.</a>


       <ul class="navbar-menu">
           <li><a href="{% url 'homepage' %}">Home</a></li>
           <li><a href="{% url 'menu' %}">Menu</a></li>
           <li><a href="{% url 'contact' %}">Contact Us</a></li>
           <li><a href="{% url 'payment' %}">Payment</a></li>
       </ul>

          <div class="hamburger">
                <div class="search-icon">
                   <i class="fa-solid fa-magnifying-glass"></i>
                </div>

                <div class="shopping-cart">
                    <a href="{% url 'cart' %}">
                        <i class="fa-solid fa-basket-shopping"></i>
                        <span class="dot" id="cart-dot-count"></span>
                    </a>
                </div>
                {% if user.is_authenticated %}
                <div class="user-menu">
                    <button class="user-btn">
                        <i class="fa-solid fa-user"></i>
                        {{ user.username }}
                    </button>
                    <div class="user-dropdown">
                        <a href="#"><i class="fa-solid fa-user"></i> Profile</a>
                        <a href="{% url 'cart' %}"><i class="fa-solid fa-shopping-bag"></i> Orders</a>
                        <a href="{% url 'logout' %}"><i class="fa-solid fa-sign-out"></i> Logout</a>
                    </div>
                </div>
                {% else %}
                    <button id="openAuthModal">sign in</button>
                {% endif %}
          </div>
   </div>

<!-------------------END OF NAVBAR------------------>

<!-- Include Auth Modal Template -->
{% include 'auth_modal.html' %}

<!----------------------------HEADER------------------------------------------------------>
   <div class="header">
       <div class="header-contents">
           <h2>Order your favorite food here</h2>
           <p>Choose from a diverse menu featuring a delectable array of dishes crafted with the finest ingredients and culinary expertise.Our mission is to satisfy your cravings and elevate your dining experience,one delicious meal at a time</p>
           <button> View Menu</button>
       </div>
   </div>

<!------------------END OF HEADER--------------->


<!-------------------------------EXPLORE-MENU----------------------------------------->
   <div class="explore-menu" id="explore-menu">
        <h1>Explore our menu</h1>
        <p class="explore-menu-text">Choose from a diverse menu featuring a delectable array of dishes crafted with the finest ingredients and culinary expertise.Our mission is to satisfy your cravings and elevate your dining experience,one delicious meal at a time</p>
        <div class="explore-menu-list">
            {% for item in menu_list %}
                <div class="explore-menu-list-item">
                    <a href="#{{ item.menu_name|lower|cut:' ' }}-section" style="text-decoration: none; color: inherit;">
                        <img src="{% static 'assets/' %}{{ item.menu_image }}" alt="{{ item.menu_name }}" style="cursor: pointer;">
                        <p>{{ item.menu_name }}</p>
                    </a>
                </div>
            {% endfor %}
        </div>
        <hr/>
   </div>


   <div class="food-display" id="food-display">
    <h2>Top dishes near you</h2>

    {% for group in grouped_foods %}
    <div id="{{ group.category|lower|cut:' ' }}-section" class="category-section">

        <!-- Scroll hint for mobile users -->
        <p class="scroll-hint">Swipe ‚Üí to see more</p>

        <!-- Wrapper for scrollable food list -->
        <div class="food-display-wrapper">

            <!-- Food items list -->
            <div class="food-display-list">
                {% for food in group.items %}
                <div class="food-item">
                    <img src="{% static 'assets/' %}{{ food.image }}" alt="{{ food.name }}">
                    <div class="food-header">
                        <h3>{{ food.name }}</h3>
                        <div class="rating">
                            {% for i in "12345" %}
                                {% if forloop.counter <= food.rating %}
                                    <i class="fa-solid fa-star"></i>
                                {% else %}
                                    <i class="fa-regular fa-star"></i>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    <p class="food-description">{{ food.description }}</p>
                    <p class="food-price">${{ food.price }}</p>
                    <div class="quantity-selector">
                        <button class="add-btn"><i class="fa-solid fa-plus"></i></button>
                        <div class="counter" style="display: none;">
                            <button class="minus-btn"><i class="fa-solid fa-minus"></i></button>
                            <span class="quantity">1</span>
                            <button class="plus-btn"><i class="fa-solid fa-plus"></i></button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

        </div>
    </div>
    {% endfor %}
</div>


<!--------------------------------FOOTER---------------------------------------->

<!-- Scroll to Top Button -->
<button class="scroll-to-top" id="scrollToTop">
    <i class="fa-solid fa-arrow-up"></i>
</button>

<footer class="footer">
    <div class="footer-container">
        <!-- Company Info Section -->
        <div class="footer-section">
            <h2 class="footer-logo">JollyFoods.</h2>
            <p class="footer-description">
                Delivering happiness one delicious meal at a time. Fresh ingredients,
                authentic flavors, and exceptional service since 2020.
            </p>
            <div class="taste-appeal">
                <div class="taste-item">
                    <i class="fa-solid fa-pepper-hot"></i>
                    <span>Spicy & Bold</span>
                </div>
                <div class="taste-item">
                    <i class="fa-solid fa-leaf"></i>
                    <span>Fresh & Organic</span>
                </div>
                <div class="taste-item">
                    <i class="fa-solid fa-fire-flame-curved"></i>
                    <span>Hot & Ready</span>
                </div>
            </div>
            <div class="social-links">
                <a href="https://facebook.com" target="_blank" aria-label="Facebook">
                    <i class="fa-brands fa-facebook"></i>
                </a>
                <a href="https://twitter.com" target="_blank" aria-label="Twitter">
                    <i class="fa-brands fa-twitter"></i>
                </a>
                <a href="https://instagram.com" target="_blank" aria-label="Instagram">
                    <i class="fa-brands fa-instagram"></i>
                </a>
                <a href="https://youtube.com" target="_blank" aria-label="YouTube">
                    <i class="fa-brands fa-youtube"></i>
                </a>
            </div>
        </div>

        <!-- Company Links -->
        <div class="footer-section">
            <h3 class="footer-title">Company</h3>
            <ul class="footer-links">
                <li><a href="{% url 'homepage' %}">Home</a></li>
                <li><a href="{% url 'menu' %}">Our Menu</a></li>
                <li><a href="#about">About Us</a></li>
                <li><a href="#careers">Careers</a></li>
                <li><a href="#blog">Blog</a></li>
                <li><a href="#press">Press Kit</a></li>
            </ul>
        </div>

        <!-- Get in Touch -->
        <div class="footer-section">
            <h3 class="footer-title">Get in Touch</h3>
            <ul class="footer-links">
                <li><a href="{% url 'contact' %}">Contact Us</a></li>
                <li><a href="#support">Customer Support</a></li>
                <li><a href="#faq">FAQ</a></li>
                <li><a href="#feedback">Feedback</a></li>
                <li><a href="#partnership">Partner With Us</a></li>
            </ul>
        </div>

        <!-- Popular Dishes -->
        <div class="footer-section">
            <h3 class="footer-title">Fan Favorites</h3>
            <ul class="footer-links dish-list">
                <li><a href="#salad-section"><i class="fa-solid fa-bowl-food"></i> Greek Salad</a></li>
                <li><a href="#pasta-section"><i class="fa-solid fa-bowl-rice"></i> Creamy Pasta</a></li>
                <li><a href="#cake-section"><i class="fa-solid fa-cake-candles"></i> Chocolate Cake</a></li>
                <li><a href="#sandwich-section"><i class="fa-solid fa-burger"></i> Club Sandwich</a></li>
                <li><a href="#noodles-section"><i class="fa-solid fa-utensils"></i> Spicy Noodles</a></li>
            </ul>
            <div class="flavor-badges">
                <span class="badge">üå∂Ô∏è Spicy</span>
                <span class="badge">üßÄ Cheesy</span>
                <span class="badge">üçÉ Vegan</span>
            </div>
        </div>

        <!-- Newsletter -->
        <div class="footer-section">
            <h3 class="footer-title">Stay Updated</h3>
            <p class="newsletter-text">Get weekly recipes, exclusive deals & food tips delivered to your inbox!</p>
            <form class="newsletter-form">
                <input type="email" placeholder="Enter your email" required>
                <button type="submit">
                    <i class="fa-solid fa-paper-plane"></i>
                </button>
            </form>
            <div class="promo-box">
                <i class="fa-solid fa-gift"></i>
                <div>
                    <strong>First Order Special</strong>
                    <p>Get 20% off your first order!</p>
                </div>
            </div>
            <div class="contact-info">
                <p><i class="fa-solid fa-phone"></i> +233 (555) 123-4567</p>
                <p><i class="fa-solid fa-envelope"></i> hello@jollyfoods.com</p>
                <p><i class="fa-solid fa-location-dot"></i> 123 Food Street, Kumasi, GH</p>
            </div>
        </div>
    </div>

    <!-- Taste Features Bar -->
    <div class="taste-features">
        <div class="taste-feature">
            <i class="fa-solid fa-clock"></i>
            <span>30-Min Delivery</span>
        </div>
        <div class="taste-feature">
            <i class="fa-solid fa-certificate"></i>
            <span>Quality Guaranteed</span>
        </div>
        <div class="taste-feature">
            <i class="fa-solid fa-heart"></i>
            <span>Made with Love</span>
        </div>
        <div class="taste-feature">
            <i class="fa-solid fa-star"></i>
            <span>5-Star Rated</span>
        </div>
    </div>

    <!-- Bottom Bar -->
    <div class="footer-bottom">
        <div class="footer-bottom-container">
            <p>&copy; 2025 JollyFoods. All rights reserved. Made with <i class="fa-solid fa-heart" style="color: #ff6b6b;"></i> in Kumasi</p>
            <div class="payment-methods">
                <i class="fa-brands fa-cc-visa" title="Visa"></i>
                <i class="fa-brands fa-cc-mastercard" title="Mastercard"></i>
                <i class="fa-brands fa-cc-paypal" title="PayPal"></i>
                <i class="fa-brands fa-cc-amex" title="American Express"></i>
                <i class="fa-brands fa-apple-pay" title="Apple Pay"></i>
            </div>
        </div>
    </div>
</footer>

<script>
// Scroll to top button functionality
const scrollToTopBtn = document.getElementById('scrollToTop');

window.addEventListener('scroll', () => {
    if (window.pageYOffset > 300) {
        scrollToTopBtn.classList.add('visible');
    } else {
        scrollToTopBtn.classList.remove('visible');
    }
});

scrollToTopBtn.addEventListener('click', () => {
    window.scrollTo({
        top: 0,
        behavior: 'smooth'
    });
});

// Newsletter form submission
document.querySelector('.newsletter-form').addEventListener('submit', (e) => {
    e.preventDefault();
    const email = e.target.querySelector('input').value;
    alert(`Thank you for subscribing! Check ${email} for your 20% discount code! üéâ`);
    e.target.reset();
});
</script>

<!--------------------------------END OF FOOTER---------------------------------->

<!---------------------JAVASCRIPT --------------------------------------------------------------------->
<script>
// Get CSRF token
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

const csrftoken = getCookie('csrftoken');

// Update cart badge
async function updateCartBadge() {
    const response = await fetch('/cart/count/');
    const data = await response.json();
    const badge = document.querySelector('.shopping-cart .dot');
    if (data.cart_count > 0) {
        badge.style.display = 'block';
        badge.textContent = data.cart_count;
        badge.style.width = '18px';
        badge.style.height = '18px';
        badge.style.display = 'flex';
        badge.style.alignItems = 'center';
        badge.style.justifyContent = 'center';
        badge.style.fontSize = '11px';
        badge.style.color = 'white';
    }
}

// Quantity selector functionality with cart integration
document.querySelectorAll('.quantity-selector').forEach(selector => {
    const addBtn = selector.querySelector('.add-btn');
    const counter = selector.querySelector('.counter');
    const minusBtn = selector.querySelector('.minus-btn');
    const plusBtn = selector.querySelector('.plus-btn');
    const quantity = selector.querySelector('.quantity');

    // Get food item details
    const foodItem = selector.closest('.food-item');
    const foodName = foodItem.querySelector('.food-header h3').textContent;
    const foodPrice = parseFloat(foodItem.querySelector('.food-price').textContent.replace('$', ''));
    const foodImage = foodItem.querySelector('img').getAttribute('src').split('/').pop();

    let currentQuantity = 1;

    addBtn.addEventListener('click', () => {
        addBtn.style.display = 'none';
        counter.style.display = 'flex';
        currentQuantity = 1;
        quantity.textContent = currentQuantity;
    });

    plusBtn.addEventListener('click', () => {
        currentQuantity++;
        quantity.textContent = currentQuantity;
    });

    minusBtn.addEventListener('click', async () => {
        if(currentQuantity > 1){
            currentQuantity--;
            quantity.textContent = currentQuantity;
        } else {
            // Add to cart before hiding
            await addToCart(foodName, foodPrice, foodImage, currentQuantity);

            counter.style.display = 'none';
            addBtn.style.display = 'flex';
            currentQuantity = 1;
            quantity.textContent = currentQuantity;
        }
    });

    // Add to cart when counter is visible and user clicks elsewhere
    counter.addEventListener('blur', async () => {
        if (counter.style.display === 'flex') {
            await addToCart(foodName, foodPrice, foodImage, currentQuantity);
        }
    }, true);
});

 // Add to cart function

async function addToCart(name, price, image, qty) {
    try {
        const response = await fetch('/cart/add/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrftoken
            },
            body: JSON.stringify({
                name: name,
                price: price,
                image: image,
                quantity: qty
            })
        });

        const data = await response.json();
        if (data.success) {
            // Show success message
            showNotification(data.message);
            updateCartBadge();
        }
    } catch (error) {
        console.error('Error adding to cart:', error);
    }
}

// Show notification
function showNotification(message) {
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #4CAF50;
        color: white;
        padding: 15px 25px;
        border-radius: 5px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        z-index: 1000;
        animation: slideIn 0.3s ease;
    `;
    notification.textContent = message;
    document.body.appendChild(notification);

    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => notification.remove(), 300);
    }, 2000);
}

// Add CSS animations
const style = document.createElement('style');
style.textContent = `
    @keyframes slideIn {
        from { transform: translateX(400px); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(400px); opacity: 0; }
    }
`;
document.head.appendChild(style);

// Update cart badge on page load
updateCartBadge();

// Make shopping cart clickable
document.querySelector('.shopping-cart').addEventListener('click', () => {
    window.location.href = "{% url 'cart' %}";
});
</script>

<!-- Include Auth Modal JavaScript -->
<script>
// Auth Modal JavaScript (only opens when clicked, no auto-popup)
(function() {
    const authModal = document.getElementById('authModal');
    const closeModal = document.getElementById('closeModal');
    const loginForm = document.getElementById('loginForm');
    const signupForm = document.getElementById('signupForm');
    const showSignup = document.getElementById('showSignup');
    const showLogin = document.getElementById('showLogin');
    const loginFormSubmit = document.getElementById('loginFormSubmit');
    const signupFormSubmit = document.getElementById('signupFormSubmit');
    const openAuthModalBtn = document.getElementById('openAuthModal');
    const phone = document.getElementById('signupPhone').value;

    // Get CSRF token
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    const csrftoken = getCookie('csrftoken');

    // Open modal when sign in button clicked
    if (openAuthModalBtn) {
        openAuthModalBtn.addEventListener('click', () => {
            authModal.classList.add('active');
            // Reset to login form
            signupForm.classList.remove('active');
            loginForm.classList.add('active');
        });
    }

    // Close modal
    closeModal.addEventListener('click', () => {
        authModal.classList.remove('active');
    });

    // Close modal on overlay click
    authModal.querySelector('.auth-modal-overlay').addEventListener('click', () => {
        authModal.classList.remove('active');
    });

    // Switch to signup form
    showSignup.addEventListener('click', (e) => {
        e.preventDefault();
        loginForm.classList.remove('active');
        signupForm.classList.add('active');
    });

    // Switch to login form
    showLogin.addEventListener('click', (e) => {
        e.preventDefault();
        signupForm.classList.remove('active');
        loginForm.classList.add('active');
    });

    // Show message function
    function showMessage(form, message, isError = false) {
        const existingMsg = form.querySelector('.auth-message');
        if (existingMsg) existingMsg.remove();

        const messageDiv = document.createElement('div');
        messageDiv.className = `auth-message ${isError ? 'error' : 'success'}`;
        messageDiv.textContent = message;
        form.insertBefore(messageDiv, form.firstChild);

        if (!isError) {
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }
    }

    // Handle login form submission
    loginFormSubmit.addEventListener('submit', async (e) => {
        e.preventDefault();

        const username = document.getElementById('loginUsername').value;
        const password = document.getElementById('loginPassword').value;
        const submitBtn = loginFormSubmit.querySelector('.auth-btn');

        submitBtn.classList.add('loading');

        try {
            const response = await fetch('/login/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken
                },
                body: JSON.stringify({
                    username: username,
                    password: password
                })
            });

            const data = await response.json();

            if (data.success) {
                showMessage(loginForm, data.message, false);
                setTimeout(() => {
                    location.reload();
                }, 1500);
            } else {
                showMessage(loginForm, data.error, true);
            }
        } catch (error) {
            showMessage(loginForm, 'An error occurred. Please try again.', true);
        } finally {
            submitBtn.classList.remove('loading');
        }
    });

    signupFormSubmit.addEventListener('submit', async (e) => {
    e.preventDefault();

    const username = document.getElementById('signupUsername').value;
    const email = document.getElementById('signupEmail').value;
    const password = document.getElementById('signupPassword').value;
    const confirmPassword = document.getElementById('signupConfirmPassword').value;
    const phone = document.getElementById('signupPhone').value; // <-- add this
    const submitBtn = signupFormSubmit.querySelector('.auth-btn');

    if (password !== confirmPassword) {
        showMessage(signupForm, 'Passwords do not match!', true);
        return;
    }

    if (password.length < 6) {
        showMessage(signupForm, 'Password must be at least 6 characters!', true);
        return;
    }

    submitBtn.classList.add('loading');

    try {
        const response = await fetch('/signup/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrftoken
            },
            body: JSON.stringify({
                username: username,
                email: email,
                password: password,
                phone: phone // <-- add comma and use defined variable
            })
        });

        const data = await response.json();

        if (data.success) {
            showMessage(signupForm, data.message, false);
            setTimeout(() => {
                location.reload();
            }, 1500);
        } else {
            showMessage(signupForm, data.error, true);
        }
    } catch (error) {
        showMessage(signupForm, 'An error occurred. Please try again.', true);
    } finally {
        submitBtn.classList.remove('loading');
    }
});
})();

<!--    script for scrolling food list-->
document.querySelectorAll('.food-display-wrapper').forEach(wrapper => {
    const hint = wrapper.querySelector('.scroll-hint');
    const list = wrapper.querySelector('.food-display-list');

    const updateHint = () => {
        const maxScroll = list.scrollWidth - list.clientWidth;
        if (list.scrollLeft >= maxScroll - 5) {
            hint.classList.add('hide');
        } else {
            hint.classList.remove('hide');
        }
    };

    list.addEventListener('scroll', updateHint);
    updateHint();
});


</script>
</body>
</html>