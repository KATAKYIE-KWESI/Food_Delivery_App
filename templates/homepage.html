{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/jpeg" href="{% static 'assets/favicon.jpg' %}">
    <title>JollyFoods</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'homepage.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'auth_modal.css' %}">

</head>
<body>

<!--------------------------------- Nav Bar ------------------------------------------->
<div class="navbar">

    <!-- Logo -->
    <a href="{% url 'homepage' %}" class="logo">
        <i class="fa-solid fa-utensils"></i> JollyFoods.
    </a>

    <!-- Desktop Navigation Menu -->
    <ul class="navbar-menu" id="navbarMenu">
        <li><a href="{% url 'homepage' %}">Home</a></li>
        <li><a href="#food-display">Menu</a></li>
        <li><a href="#contact">Contact Us</a></li>
        <li><a href="{% url 'payment' %}">Payment</a></li>
    </ul>

    <!-- Right Side Icons + Auth -->
    <div class="hamburger">


        <!-- üõí Cart -->
        <div class="shopping-cart">
            <a href="{% url 'cart' %}">
                <i class="fa-solid fa-basket-shopping"></i>
                <span class="dot" id="cart-dot-count"></span>
            </a>
        </div>

        <!-- üë§ Auth -->
        {% if user.is_authenticated %}
        <div class="user-menu">
            <button class="user-btn">
                <i class="fa-solid fa-user"></i>
               <span>{{ user.username }}</span>
            </button>

            <div class="user-dropdown">

                <a href="{% url 'cart' %}"><i class="fa-solid fa-shopping-bag"></i> Orders</a>
                <a href="{% url 'logout' %}"><i class="fa-solid fa-sign-out"></i> Logout</a>
            </div>
        </div>
        {% else %}
            <button id="openAuthModal">Sign in</button>
        {% endif %}

        <!-- ‚ò∞ Mobile Menu Toggle -->
        <div class="menu-toggle" id="menuToggle">
            <i class="fa-solid fa-bars"></i>
        </div>

    </div>
</div>


<!-------------------END OF NAVBAR------------------>

<!-- Include Auth Modal Template -->
{% include 'auth_modal.html' %}

<!----------------------------HEADER------------------------------------------------------>
   <div class="header">
       <div class="header-contents">
           <h2>Order your favorite food here</h2>
           <p>Choose from a diverse menu featuring a delectable array of dishes crafted with the finest ingredients and culinary expertise.Our mission is to satisfy your cravings and elevate your dining experience,one delicious meal at a time</p>
           <button> View Menu</button>
       </div>
   </div>

<!------------------END OF HEADER--------------->


<!-------------------------------EXPLORE-MENU----------------------------------------->
   <div class="explore-menu" id="explore-menu">
        <h1>Explore our menu</h1>
        <p class="explore-menu-text">Choose from a diverse menu featuring a delectable array of dishes crafted with the finest ingredients and culinary expertise.Our mission is to satisfy your cravings and elevate your dining experience,one delicious meal at a time</p>
        <div class="explore-menu-list">
            {% for item in menu_list %}
                <div class="explore-menu-list-item">
                    <a href="#{{ item.menu_name|lower|cut:' ' }}-section" style="text-decoration: none; color: inherit;">
                        <img src="{% static 'assets/' %}{{ item.menu_image }}" alt="{{ item.menu_name }}" style="cursor: pointer;">
                        <p>{{ item.menu_name }}</p>
                    </a>
                </div>
            {% endfor %}
        </div>
        <hr/>
   </div>


        <div class="food-display" id="food-display">
        <h2>Top dishes near you</h2>

      {% for group in grouped_foods %}
        <div id="{{ group.category|lower|cut:' ' }}-section" class="category-section">

                  <div class="swipe-indicator">
                <span>Swipe for more</span>
                <i class="fa-solid fa-arrow-right-long"></i>
            </div>

          <div class="food-display-list">
            {% for food in group.items %}
              <div class="food-item">
                <img src="{% static 'assets/' %}{{ food.image }}" alt="{{ food.name }}">
                <div class="food-header">
                  <h3>{{ food.name }}</h3>
                  <div class="rating">
                    {% for i in "12345" %}
                      {% if forloop.counter <= food.rating %}
                        <i class="fa-solid fa-star"></i>
                      {% else %}
                        <i class="fa-regular fa-star"></i>
                      {% endif %}
                    {% endfor %}
                  </div>

                </div>
                <p class="food-description">{{ food.description }}</p>
                <p class="food-price">${{ food.price }}</p>
                <div class="quantity-selector">
                  <button class="add-btn"><i class="fa-solid fa-plus"></i></button>
                  <div class="counter" style="display: none;">
                    <button class="minus-btn"><i class="fa-solid fa-minus"></i></button>
                    <span class="quantity">1</span>
                    <button class="plus-btn"><i class="fa-solid fa-plus"></i></button>
                  </div>
                </div>
              </div>
            {% endfor %}

          </div>
        </div>

      {% endfor %}
    </div>


<!--------------------------------FOOTER---------------------------------------->

<!-- Scroll to Top Button -->
<button class="scroll-to-top" id="scrollToTop">
    <i class="fa-solid fa-arrow-up"></i>
</button>

<footer class="footer" id="contact">
    <div class="footer-container">
        <!-- Company Info Section -->
        <div class="footer-section">
            <h2 class="footer-logo">JollyFoods.</h2>
            <p class="footer-description">
                Delivering happiness one delicious meal at a time. Fresh ingredients,
                authentic flavors, and exceptional service since 2020.
            </p>
            <div class="taste-appeal">
                <div class="taste-item">
                    <i class="fa-solid fa-pepper-hot"></i>
                    <span>Spicy & Bold</span>
                </div>
                <div class="taste-item">
                    <i class="fa-solid fa-leaf"></i>
                    <span>Fresh & Organic</span>
                </div>
                <div class="taste-item">
                    <i class="fa-solid fa-fire-flame-curved"></i>
                    <span>Hot & Ready</span>
                </div>
            </div>
            <div class="social-links">
                <a href="https://facebook.com" target="_blank" aria-label="Facebook">
                    <i class="fa-brands fa-facebook"></i>
                </a>
                <a href="https://twitter.com" target="_blank" aria-label="Twitter">
                    <i class="fa-brands fa-twitter"></i>
                </a>
                <a href="https://instagram.com" target="_blank" aria-label="Instagram">
                    <i class="fa-brands fa-instagram"></i>
                </a>
                <a href="https://youtube.com" target="_blank" aria-label="YouTube">
                    <i class="fa-brands fa-youtube"></i>
                </a>
            </div>
        </div>

        <!-- Company Links -->
        <div class="footer-section">
            <h3 class="footer-title">Company</h3>
            <ul class="footer-links">
                <li><a href="{% url 'homepage' %}">Home</a></li>
                <li><a href="#food-display">Our Menu</a></li>
                <li><a href="#about">About Us</a></li>
                <li><a href="#careers">Careers</a></li>
                <li><a href="#blog">Blog</a></li>
                <li><a href="#press">Press Kit</a></li>
            </ul>
        </div>

        <!-- Get in Touch -->
        <div class="footer-section">
            <h3 class="footer-title">Get in Touch</h3>
            <ul class="footer-links">
                <li><a href="#contact">Contact Us</a></li>
                <li><a href="#support">Customer Support</a></li>
                <li><a href="#faq">FAQ</a></li>
                <li><a href="#feedback">Feedback</a></li>
                <li><a href="#partnership">Partner With Us</a></li>
            </ul>
        </div>

        <!-- Popular Dishes -->
        <div class="footer-section">
            <h3 class="footer-title">Fan Favorites</h3>
            <ul class="footer-links dish-list">
                <li><a href="#salad-section"><i class="fa-solid fa-bowl-food"></i> Greek Salad</a></li>
                <li><a href="#pasta-section"><i class="fa-solid fa-bowl-rice"></i> Creamy Pasta</a></li>
                <li><a href="#cake-section"><i class="fa-solid fa-cake-candles"></i> Chocolate Cake</a></li>
                <li><a href="#sandwich-section"><i class="fa-solid fa-burger"></i> Club Sandwich</a></li>
                <li><a href="#noodles-section"><i class="fa-solid fa-utensils"></i> Spicy Noodles</a></li>
            </ul>
            <div class="flavor-badges">
                <span class="badge">üå∂Ô∏è Spicy</span>
                <span class="badge">üßÄ Cheesy</span>
                <span class="badge">üçÉ Vegan</span>
            </div>
        </div>

        <!-- Newsletter -->
        <div class="footer-section">
            <h3 class="footer-title">Stay Updated</h3>
            <p class="newsletter-text">Get weekly recipes, exclusive deals & food tips delivered to your inbox!</p>
            <form class="newsletter-form">
                <input type="email" placeholder="Enter your email" required>
                <button type="submit">
                    <i class="fa-solid fa-paper-plane"></i>
                </button>
            </form>
            <div class="promo-box">
                <i class="fa-solid fa-gift"></i>
                <div>
                    <strong>First Order Special</strong>
                    <p>Get 20% off your first order!</p>
                </div>
            </div>
            <div class="contact-info">
                <p><i class="fa-solid fa-phone"></i> +233 (555) 123-4567</p>
                <p><i class="fa-solid fa-envelope"></i> hello@jollyfoods.com</p>
                <p><i class="fa-solid fa-location-dot"></i> 123 Food Street, Kumasi, GH</p>
            </div>
        </div>
    </div>

    <!-- Taste Features Bar -->
    <div class="taste-features">
        <div class="taste-feature">
            <i class="fa-solid fa-clock"></i>
            <span>30-Min Delivery</span>
        </div>
        <div class="taste-feature">
            <i class="fa-solid fa-certificate"></i>
            <span>Quality Guaranteed</span>
        </div>
        <div class="taste-feature">
            <i class="fa-solid fa-heart"></i>
            <span>Made with Love</span>
        </div>
        <div class="taste-feature">
            <i class="fa-solid fa-star"></i>
            <span>5-Star Rated</span>
        </div>
    </div>

    <!-- Bottom Bar -->
    <div class="footer-bottom">
        <div class="footer-bottom-container">
            <p>&copy; 2025 JollyFoods. All rights reserved. Made with <i class="fa-solid fa-heart" style="color: #ff6b6b;"></i> in Kumasi</p>
            <div class="payment-methods">
                <i class="fa-brands fa-cc-visa" title="Visa"></i>
                <i class="fa-brands fa-cc-mastercard" title="Mastercard"></i>
                <i class="fa-brands fa-cc-paypal" title="PayPal"></i>
                <i class="fa-brands fa-cc-amex" title="American Express"></i>
                <i class="fa-brands fa-apple-pay" title="Apple Pay"></i>
            </div>
        </div>
    </div>
</footer>


<!--------------------------------END OF FOOTER---------------------------------->

<!---------------------JAVASCRIPT --------------------------------------------------------------------->
<script>
// Scroll to top button functionality
const scrollToTopBtn = document.getElementById('scrollToTop');

window.addEventListener('scroll', () => {
    if (window.pageYOffset > 300) {
        scrollToTopBtn.classList.add('visible');
    } else {
        scrollToTopBtn.classList.remove('visible');
    }
});

scrollToTopBtn.addEventListener('click', () => {
    window.scrollTo({
        top: 0,
        behavior: 'smooth'
    });
});

// Newsletter form submission
document.querySelector('.newsletter-form').addEventListener('submit', (e) => {
    e.preventDefault();
    const email = e.target.querySelector('input').value;
    alert(`Thank you for subscribing! Check ${email} for your 20% discount code! üéâ`);
    e.target.reset();
});
</script>


<!-- Include Auth Modal JavaScript -->
<script>
// Auth Modal JavaScript (only opens when clicked, no auto-popup)
(function() {
    const authModal = document.getElementById('authModal');
    const closeModal = document.getElementById('closeModal');
    const loginForm = document.getElementById('loginForm');
    const signupForm = document.getElementById('signupForm');
    const showSignup = document.getElementById('showSignup');
    const showLogin = document.getElementById('showLogin');
    const loginFormSubmit = document.getElementById('loginFormSubmit');
    const signupFormSubmit = document.getElementById('signupFormSubmit');
    const openAuthModalBtn = document.getElementById('openAuthModal');


    // Get CSRF token
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    const csrftoken = getCookie('csrftoken');

    // Open modal when sign in button clicked
    if (openAuthModalBtn) {
        openAuthModalBtn.addEventListener('click', () => {
            authModal.classList.add('active');
            // Reset to login form
            signupForm.classList.remove('active');
            loginForm.classList.add('active');
        });
    }

    // Close modal
    closeModal.addEventListener('click', () => {
        authModal.classList.remove('active');
    });

    // Close modal on overlay click
    authModal.querySelector('.auth-modal-overlay').addEventListener('click', () => {
        authModal.classList.remove('active');
    });

    // Switch to signup form
    showSignup.addEventListener('click', (e) => {
        e.preventDefault();
        loginForm.classList.remove('active');
        signupForm.classList.add('active');
    });

    // Switch to login form
    showLogin.addEventListener('click', (e) => {
        e.preventDefault();
        signupForm.classList.remove('active');
        loginForm.classList.add('active');
    });

    // Show message function
    function showMessage(form, message, isError = false) {
        const existingMsg = form.querySelector('.auth-message');
        if (existingMsg) existingMsg.remove();

        const messageDiv = document.createElement('div');
        messageDiv.className = `auth-message ${isError ? 'error' : 'success'}`;
        messageDiv.textContent = message;
        form.insertBefore(messageDiv, form.firstChild);

        if (!isError) {
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }
    }

    // Handle login form submission
    loginFormSubmit.addEventListener('submit', async (e) => {
        e.preventDefault();

        const username = document.getElementById('loginUsername').value;
        const password = document.getElementById('loginPassword').value;
        const submitBtn = loginFormSubmit.querySelector('.auth-btn');


        submitBtn.classList.add('loading');

        try {
            const response = await fetch('/login/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken
                },
                body: JSON.stringify({
                    username: username,
                    password: password,

                })
            });

            const data = await response.json();

            if (data.success) {
                showMessage(loginForm, data.message, false);
                setTimeout(() => {
                    location.reload();
                }, 1500);
            } else {
                showMessage(loginForm, data.error, true);
            }
        } catch (error) {
            showMessage(loginForm, 'An error occurred. Please try again.', true);
        } finally {
            submitBtn.classList.remove('loading');
        }
    });

    signupFormSubmit.addEventListener('submit', async (e) => {
    e.preventDefault();

    const username = document.getElementById('signupUsername').value;
    const email = document.getElementById('signupEmail').value;
    const password = document.getElementById('signupPassword').value;
    const confirmPassword = document.getElementById('signupConfirmPassword').value;
    const submitBtn = signupFormSubmit.querySelector('.auth-btn');



    if (password !== confirmPassword) {
        showMessage(signupForm, 'Passwords do not match!', true);
        return;
    }

    if (password.length < 6) {
        showMessage(signupForm, 'Password must be at least 6 characters!', true);
        return;
    }

    submitBtn.classList.add('loading');

    try {
        const response = await fetch('/signup/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrftoken
            },
            body: JSON.stringify({
                username: username,
                email: email,
                password: password,



            })
        });

        const data = await response.json();

        if (data.success) {
            showMessage(signupForm, data.message, false);
            setTimeout(() => {
                location.reload();
            }, 1500);
        } else {
            showMessage(signupForm, data.error, true);
        }
    } catch (error) {
        showMessage(signupForm, 'An error occurred. Please try again.', true);
    } finally {
        submitBtn.classList.remove('loading');
    }
});
})();

  // Professional Scroll Reveal Animation System for JollyFoods
(function() {
    class ScrollRevealSystem {
        constructor() {
            this.elements = new Map();
            this.windowHeight = window.innerHeight;
            this.lastScroll = 0;
            this.ticking = false;
            this.init();
        }

        init() {
            // Register elements to animate
            this.registerElement('.explore-menu');
            this.registerElement('.explore-menu-list');
            this.registerElement('.food-display');

            // Register all category sections and their food lists
            document.querySelectorAll('.category-section').forEach(section => {
                this.registerElement(section);
                const foodList = section.querySelector('.food-display-list');
                if (foodList) {
                    this.registerElement(foodList);
                }
            });

            this.registerElement('.footer');

            // Event listeners
            window.addEventListener('scroll', () => this.requestTick());
            window.addEventListener('resize', () => {
                this.windowHeight = window.innerHeight;
                this.requestTick();
            });

            // Initial check
            this.check();

            // Navbar hide/show on scroll
            this.initNavbarScroll();

            // Parallax effect
            this.initParallax();
        }

        registerElement(selector) {
            const elements = typeof selector === 'string'
                ? document.querySelectorAll(selector)
                : [selector];

            elements.forEach(el => {
                if (el && !this.elements.has(el)) {
                    this.elements.set(el, { revealed: false });
                }
            });
        }

        requestTick() {
            if (!this.ticking) {
                window.requestAnimationFrame(() => {
                    this.check();
                    this.ticking = false;
                });
                this.ticking = true;
            }
        }

        check() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

            this.elements.forEach((data, element) => {
                const rect = element.getBoundingClientRect();
                const elementTop = rect.top;
                const elementBottom = rect.bottom;

                // Element is in viewport (with 20% buffer)
                const inView = elementTop < this.windowHeight * 0.8 && elementBottom > this.windowHeight * 0.2;

                if (inView) {
                    if (!element.classList.contains('revealed')) {
                        element.classList.add('revealed');
                    }
                } else {
                    // Remove revealed class when out of view to replay animation
                    if (element.classList.contains('revealed')) {
                        element.classList.remove('revealed');
                    }
                }
            });
        }

        initNavbarScroll() {
            const navbar = document.querySelector('.navbar');
            if (!navbar) return;

            window.addEventListener('scroll', () => {
                const currentScroll = window.pageYOffset;

                if (currentScroll > this.lastScroll && currentScroll > 150) {
                    navbar.style.transform = 'translateY(-100%)';
                } else {
                    navbar.style.transform = 'translateY(0)';
                }

                this.lastScroll = currentScroll;
            });
        }

        initParallax() {
            const parallaxElements = document.querySelectorAll('.food-item img, .explore-menu-list-item img');
            let rafId = null;

            const updateParallax = () => {
                parallaxElements.forEach(el => {
                    const rect = el.getBoundingClientRect();

                    if (rect.top < this.windowHeight && rect.bottom > 0) {
                        const rate = (rect.top - this.windowHeight / 2) * 0.03;
                        el.style.transform = `translateY(${rate}px)`;
                    }
                });
                rafId = null;
            };

            window.addEventListener('scroll', () => {
                if (!rafId) {
                    rafId = requestAnimationFrame(updateParallax);
                }
            });
        }
    }

    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
            new ScrollRevealSystem();
        });
    } else {
        new ScrollRevealSystem();
    }
})();

document.addEventListener('DOMContentLoaded', () => {
    const menuToggle = document.getElementById('menuToggle');
    const navbarMenu = document.getElementById('navbarMenu');
    const openAuthModalMenu = document.getElementById('openAuthModalMenu');
    const authModal = document.getElementById('authModal');

    // Toggle Hamburger
    if (menuToggle) {
        menuToggle.addEventListener('click', () => {
            navbarMenu.classList.toggle('active');
        });
    }

    // Open Modal and Blur Navbar
    if (openAuthModalMenu) {
        openAuthModalMenu.addEventListener('click', (e) => {
            e.preventDefault();
            authModal.classList.add('active');
            navbarMenu.classList.remove('active');

            // Add this line to blur the background/navbar
            document.body.classList.add('modal-open');
        });
    }

    // Close Modal and Remove Blur
    // Assuming you have a close button or click-outside logic
    window.addEventListener('click', (e) => {
        if (e.target === authModal) {
            authModal.classList.remove('active');
            document.body.classList.remove('modal-open'); // Remove blur
        }
    });
});


<!--Allows the swipe for more to disappear once the user starts scrolling-->
document.addEventListener('DOMContentLoaded', () => {
    // Select all scrollable food lists
    const foodLists = document.querySelectorAll('.food-display-list');

    foodLists.forEach(list => {
        list.addEventListener('scroll', function() {
            // Find the indicator within the SAME category section
            const section = this.closest('.category-section');
            const indicator = section ? section.querySelector('.swipe-indicator') : null;

            // If user scrolled more than 30px, fade out the hint
            if (indicator && this.scrollLeft > 30) {
                indicator.style.opacity = '0';
                indicator.style.pointerEvents = 'none';
                // Optional: remove from layout after fade
                setTimeout(() => {
                    indicator.style.visibility = 'hidden';
                }, 500);
            }
        }, { passive: true });
    });
});

</script>

<script>
// ================= UTILS & CSRF =================
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let cookie of cookies) {
            cookie = cookie.trim();
            if (cookie.startsWith(name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

const csrftoken = getCookie('csrftoken');

// ================= NOTIFICATION SYSTEM =================
function showNotification(message) {
    const existingNote = document.querySelector('.cart-notification');
    if (existingNote) existingNote.remove();

    const note = document.createElement('div');
    note.className = 'cart-notification';
    note.innerHTML = `<i class="fa-solid fa-circle-check"></i> ${message}`;

    note.style.cssText = `
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%) translateY(100px);
        background: #333;
        color: white;
        padding: 12px 25px;
        border-radius: 50px;
        z-index: 10000;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        white-space: nowrap;
    `;

    document.body.appendChild(note);
    setTimeout(() => { note.style.transform = 'translateX(-50%) translateY(0)'; }, 100);

    setTimeout(() => {
        note.style.opacity = '0';
        note.style.transform = 'translateX(-50%) translateY(20px)';
        setTimeout(() => note.remove(), 400);
    }, 2500);
}

// ================= CART ACTIONS =================
async function updateCartBadge() {
    try {
        const res = await fetch('/cart/count/');
        const data = await res.json();
        const badge = document.getElementById('cart-dot-count');

        if (data.cart_count > 0) {
            badge.style.display = 'flex';
            badge.textContent = data.cart_count;
            badge.classList.add('badge-bump');
            setTimeout(() => badge.classList.remove('badge-bump'), 300);
        } else {
            badge.style.display = 'none';
        }
    } catch (err) { console.error('Badge error:', err); }
}

async function addToCart(name, price, image, quantity) {
    try {
        const response = await fetch('/cart/add/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrftoken
            },
            body: JSON.stringify({ name, price, image, quantity })
        });

        const data = await response.json();
        if (data.success) {
            updateCartBadge();
            if (quantity > 0) showNotification(`${name} added!`);
        }
    } catch (error) { console.error('Add error:', error); }
}

// ================= UI EVENT LISTENERS =================
document.querySelectorAll('.food-item').forEach(foodItem => {
    const addBtn = foodItem.querySelector('.add-btn');
    const counter = foodItem.querySelector('.counter');
    const minusBtn = foodItem.querySelector('.minus-btn');
    const plusBtn = foodItem.querySelector('.plus-btn');
    const quantityEl = foodItem.querySelector('.quantity');

    const name = foodItem.querySelector('.food-header h3').textContent;
    const priceText = foodItem.querySelector('.food-price').textContent;
    const price = parseFloat(priceText.replace(/[^\d.]/g, ''));
    const image = foodItem.querySelector('img').src.split('/').pop();

    let quantity = 0;

    const updateUI = async (e, newQty) => {
        e.preventDefault();
        e.stopPropagation();

        quantity = newQty;
        quantityEl.textContent = quantity;

        if (quantity > 0) {
            addBtn.style.display = 'none';
            counter.style.display = 'flex';
        } else {
            counter.style.display = 'none';
            addBtn.style.display = 'flex';
        }
        await addToCart(name, price, image, quantity);
    };

    // Use pointerup for better mobile response
    addBtn.addEventListener('click', (e) => updateUI(e, 1));
    plusBtn.addEventListener('click', (e) => updateUI(e, quantity + 1));
    minusBtn.addEventListener('click', (e) => updateUI(e, Math.max(0, quantity - 1)));
});

document.addEventListener('DOMContentLoaded', () => {
    updateCartBadge();
    const cartIcon = document.querySelector('.shopping-cart');
    if (cartIcon) {
        cartIcon.addEventListener('click', () => { window.location.href = "{% url 'cart' %}"; });
    }
});
</script>

{% include 'ai_chatbot.html' %}
</body>
</html>